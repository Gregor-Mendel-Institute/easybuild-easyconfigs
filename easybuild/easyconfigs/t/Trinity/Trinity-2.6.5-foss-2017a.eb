easyblock = 'ConfigureMake'

name = 'Trinity'
version = '2.6.5'

homepage = 'https://github.com/trinityrnaseq/trinityrnaseq/wiki'
description = """Trinity assembles transcript sequences from Illumina RNA-Seq data."""

toolchain = {'name': 'foss', 'version': '2017a'}

tnamever = '%(namelower)srnaseq-%(version)s'
source_urls = ['https://github.com/trinityrnaseq/trinityrnaseq/archive/']
sources = [{
    'filename': '%(name)s-v%(version)s.tar.gz',
    'extract_cmd': 'tar --strip-components=1 -xzvf %s',  # we build in this dir directly, as install is broken
}]
checksums = ['fe8e056ce40e5e3056d7f71cf95a2ccc6e11f6ec60867f56769ba463baae5b43']

dependencies = [
    ('Perl', '5.24.1'),
    ('Jellyfish', '2.2.6'),
    ('SAMtools', '1.6'),
    ('HTSlib', '1.6'),
    ('Bowtie2', '2.3.2'),
    ('Salmon', '0.9.1'),
    ('Java', '1.8.0_92', '', True),
]

buildininstalldir = 'True'
skipsteps = ['configure', 'install']

buildopts = " all plugins && cd trinity-plugins/scaffold_iworm_contigs && make "

sanity_check_paths = {
    'dirs': ['Chrysalis', 'Inchworm/bin', 'trinity-plugins/ParaFly-0.1.0',
             'trinity-plugins/scaffold_iworm_contigs', 'trinity-plugins/BIN'],
    'files': ['Chrysalis/RunButterfly', 'trinity-plugins/BIN/ParaFly',
              'trinity-plugins/scaffold_iworm_contigs/scaffold_iworm_contigs'],
}

sanity_check_commands = [
    ('make', 'test'),
]

modextrapaths = {
    'TRINITY_HOME': '',
    'PATH': ['.', 'trinity-plugins/BIN', 'Inchworm/bin',
             'trinity-plugins/scaffold_iworm_contigs', 'trinity-plugins/slclust/bin'],
}

moduleclass = 'bio'
